@startuml
title Log In With Username And Password
actor User
participant Frontend
participant Router
participant Controller
participant Service
participant Repository
participant Database

activate Frontend
User -> Frontend: .handleLogInClick()
Frontend -->> User: Show login form

User -> Frontend: .handleLogInSubmit(username, password)
Frontend -> Router: POST /api/login
activate Router
Router -> Controller: .LogIn(username, password)
activate Controller
Controller -> Service: .LogIn(username, password)
activate Service
Service -> Repository: .LogIn(username, password)
activate Repository
Repository -> Database: SELECT * FROM users WHERE username = @username AND password = @password
activate Database
Database -->> Repository: User
deactivate Database
Repository -->> Service: User
deactivate Repository

alt User == Error
  Service -->> Controller: User
  Controller -->> Router: 401 Unauthorized
  Router -->> Frontend: 401 Unauthorized
  Frontend -->> User: Show error "Invalid username or password"
else User == Null
  Service -->> Controller: User
  Controller -->> Router: 404 Not Found
  Router -->> Frontend: 404 Not Found
  Frontend -->> User: Show error "User not found"
else
  Service -> Repository: .GetSessionToken(username)
  activate Repository
  Repository -->> Service: SessionToken
  deactivate Repository
  Service ->> Service: .SetSessionToken(SessionToken)
  Service -->> Controller: User with SessionToken
  deactivate Service
  Controller -->> Router: 200 OK
  Router -->> Frontend: 200 OK
  Frontend -->> User: Show success "Logged in"
end
deactivate Service
@enduml