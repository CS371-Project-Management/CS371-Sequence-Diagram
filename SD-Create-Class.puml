@startuml
title Create Class

actor User
participant "Frontend" as FE
participant Router
participant "Middleware" as MW
participant "Class Controller" as Controller
participant "Class Service" as Service
participant "Class Repository" as Repository
participant "Database" as DB

'Display Create Class Form'
User -> FE: handleCreateClassClick()
FE -> User: displayCreateClassForm()

'Submit Create Class'
User -> FE: handleCreateClassSubmit(name, description, privacy)
FE -> Router: POST /api/classes {name, description, privacy}
activate Router
Router -> MW: validateRequest()
activate MW
MW -> Controller: CreateClass(name, description, privacy)
activate Controller
Controller -> Controller: validateInput()

alt invalidInput (4.1a)
    Controller -> MW: returnError("ข้อมูลไม่ครบถ้วนหรือข้อมูลไม่ถูกต้อง")
    MW -> Router: returnErrorResponse(400)
    Router -> FE: errorResponse(400)
else validInput (4.1)
    Controller -> Service: CreateClass(name, description, privacy)
    activate Service
    Service -> Repository: insertClass(name, description, privacy, userID)
    activate Repository
    Repository -> DB: INSERT INTO classes (name, description, privacy, owner_id) VALUES (?,?,?,?)
    activate DB
    DB -->> Repository: affectedRows / classRecord
    deactivate DB
    alt insertFailure (5.1a)
        Repository -> Service: returnError("ไม่สามารถบันทึกการสร้าง class ได้")
        deactivate Repository
        Service -> Controller: returnError("ไม่สามารถบันทึกการสร้าง class ได้")
        deactivate Service
        Controller -> MW: returnError("ไม่สามารถบันทึกการสร้าง class ได้")
        MW -> Router: returnErrorResponse(500, "ไม่สามารถบันทึกการสร้าง class ได้")
        Router -> FE: errorResponse(500, "ไม่สามารถบันทึกการสร้าง class ได้")
    else insertSuccess (5.1)
        Repository -> Service: returnClassRecord(classRecord)
        deactivate Repository
        Service -> Controller: returnClassRecord(classRecord)
        deactivate Service
        Controller -> MW: returnSuccess("สร้าง class สำเร็จ", classRecord)
        MW -> Router: successResponse(201, classRecord)
        Router -> FE: successResponse(201, classRecord)
        Controller -> FE: -
        FE -> User: displayMessage("สร้าง class สำเร็จ")
    end
end
deactivate Controller
deactivate MW
deactivate Router

@enduml
